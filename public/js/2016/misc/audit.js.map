{"version":3,"sources":["audit.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"audit.js","sourcesContent":["/**\n * Created by Mike on 6/3/15.\n * see readme for details\n */\n//Countdown Component\nvar Timer = {\n    template: '#timer',\n    props:['firstStartTime', 'zeroMsg', 'time', 'msg'],\n    data: function(){\n        return {\n            intervalTime: 1000,\n            zeroMsg: '',\n            intervalCallback: \"function(){}\",\n            intervalID: 0\n        };\n    },\n    created: function(){\n        //bind listeners\n        this.$on('timerMsg', function(msg){\n            this.timerMsg = msg;\n        });\n        this.$on('startChildTimer', function(time){\n            this.start(time);\n        });\n        this.$on('setTimerMsg', function(msg){\n            this.msg = msg\n        });\n    },\n    compiled: function(){\n        this.time = this.firstStartTime;\n        this.msg = this.time;\n    },\n    methods: {\n        start: function(time){\n            if(!time){\n                this.setTime(this.firstStartTime);\n            }\n            this.setTime(time);\n            this.intervalID = setInterval(this.decriment, 1000);\n        },\n        stop: function(){\n            window.clearInterval(this.intervalID);\n            this.$dispatch('timerComplete');\n        },\n        decriment: function(){\n            this.msg = this.time;\n            if(this.time < 1) {\n                this.msg = this.zeroMsg;\n                this.stop();\n            }\n            this.time--;\n        },\n        setTime: function(time){\n            this.time = Math.floor(time);\n        }\n    }\n};\n\nVue.filter('number', function (value) {\n    if (typeof(value) == 'undefined') {\n        return '';\n    }\n    return value.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n});\nVue.filter('classname', function (value) {\n    return value.replace(/\\s+/g, '-').toLowerCase();\n});\n\n// Report is responsible for holding the results and displaying them\nvar Report = new Vue({\n    el: '#audisee',\n    components: { timer: Timer},\n    data: {\n        carrier: \"\",\n        title: 'Loading Audit Results',\n        total_records: '0',\n        total_shipments: 0,\n        annual_spend: 0,\n        selected_point: 'late-deliveries',\n        shipment_range: {\n            start: \"\",\n            end: \"\" //  06/18/2015\n        },\n        points: {},\n        findings: {},\n        invoice_details: {},\n        uploadProgress: 0,\n        progressTitle: 'Uploading.',\n        timerCallback: []\n    },\n    computed: {\n        recovery_percent: function(){\n            return (this.total_recovery / this.total_dollars_audited).toFixed(2) * 100;\n        },\n        total_dollars_audited: function(){\n            var total = 0;\n            $(this.invoice_details).each(function(){\n                total = total + parseFloat(this.invoice_total);\n            });\n            return total;\n        },\n        isUPS: function () {\n            return (this.carrier_name == 'UPS');\n        },\n        isFedEx: function () {\n            return (this.carrier_name == 'FedEx');\n        },\n        carrier_name: function(){\n            var name = {'ups' : 'UPS' , 'fedex' : 'FedEx', '' : ''};\n            return name[this.carrier];\n        },\n        total_findings: function () {\n            return this.findings.length;\n        },\n        total_recovery: function(){\n            var total = 0;\n            $(this.findings).each(function () {\n                total = total + parseFloat(this.charge_amount);\n            });\n            return total;\n        },\n        tracking_url: function () {\n            if (this.carrier == 'ups') {\n                url = 'http://wwwapps.ups.com/WebTracking/track?track=yes&trackNums=';\n            } else {\n                url = 'http://www.fedex.com/Tracking?action=track&tracknumbers=';\n            }\n            return url\n        },\n        selected_findings: function(){\n            var selected = [];\n            var parent = this;\n            $(this.findings).each(function(){\n               if(this.audit_point == parent.selected_point){\n                   selected.push(this);\n               }\n            });\n            return selected;\n        },\n        pointsWithFindings: function(){\n            var relevant = {};\n            for(var finding in this.findings){\n                var point = this.findings[finding].audit_point;\n                if(this.count(this.findings[finding].audit_point) > 0){\n                    relevant[point] = this.findings[finding];\n                }\n            }\n            return relevant;\n        }\n    },\n    created: function(){\n      this.$on('timerComplete', function(){\n          if(this.timerCallback !== []){\n              this.timerCallback();\n          }\n      });\n    },\n    methods: {\n        timerMsg: function(msg){\n            this.$broadcast('updateChildTimerMsg', msg);\n        },\n        startTimer: function(time){\n            if(!time){\n                time = 25;\n            }\n            this.$broadcast('startChildTimer', time);\n        },\n        pointTotal: function (point) {\n            var t = 0;\n            $(this.findings).each(function () {\n                if (this.audit_point == point) {\n                    t = parseFloat(t) + parseFloat(this.charge_amount);\n                }\n            });\n            return t;\n        },\n        count: function (point) {\n            var t = 0;\n            $(this.findings).each(function () {\n                if (this.audit_point == point) {\n                    t++;\n                }\n            });\n            return t;\n        }\n    }\n});\n\n// We assign the points here becuse it would be destracting up there^\nReport.points = {\n    'late-deliveries': {\n        name: 'Late Deliveries',\n        description: 'Shipments have a guaranteed delivery date based on the service level, distance traveled, and pickup date. To make this report as accurate  as possible, we\\'ve scrubbed unrecoverable items such as shipments delayed due to weather.',\n        total: 0\n    }, 'never-delivered': {\n        name: 'Never Delivered',\n        description: 'These shipments never arrived at their destination.',\n        total: 0\n    }, 'manifested-not-shipped': {\n        name: 'Manifested, Not Shipped',\n        description: 'A label was printed but no package was ever actually picked up.',\n        total: 0\n    }, 'saturday-pickups': {\n        name: 'Invalid Saturday Pickups',\n        description: 'An additional charge was placed for a Saturday Pickup when the actual pickup date was not on a Saturday.',\n        total: 0\n    }, 'saturday-deliveries': {\n        name: 'Invalid Saturday Deliveries',\n        description: 'An additional charge was placed for a Saturday Delivery when the actual delivery date was not on a Saturday.',\n        total: 0\n    }, 'residential-surcharge': {\n        name: 'Invalid Residential Fee',\n        description: 'An additional charge was placed for a Residential Delivery and, at a glance, we suspect these shipments were sent to commercial buildings.',\n        total: 0\n    }\n};\n\n\n// Audit is (mostly) responsible for communicating with the server and\n// passing results to the other objects\nAuditController = {\n    AuditID: '',\n    Error: '',\n    BaseUrl: '/audisee/instant-parcel-audit/',\n    AnimationRuntime: 15000, // in ms\n    FetchResultsDelay: 0,\n    UpsFetchResultsDelay: 30000,\n    FedExFetchResultsDelay: 15000,\n    RuntimeBufferTime: 3000,\n    animatedUpsStatus: false,\n    uncompellingMessageMaxSavings: 20, //shows a message if the total savings is under this value\n    upsProgressDelayInSeconds: 10,\n    nocache: function (){\n        return '?nocache=' + Math.floor(Date.now() / 1000);\n    },\n    showUploadProgress: function(){\n        $('.step:visible > h2, .step:visible > div:nth-child(2)').show();\n        //reset incase of bad entry\n        Report.progressTitle = 'Uploading.';\n        $('#unknown-file').hide();\n        Report.uploadProgress = 0;\n        $('.radial-progress').show();\n        $('.upload-messages').show();\n        //end reset\n        Interview.showStep(2);\n    },\n    uploadCSV: function () {\n        AuditController.showUploadProgress();\n        $('#uploading-overlay').addClass('active');\n        slack('Audisee: ' + abGet('audisee-landing'));\n        setTimeout(function () { //ux delay\n            var data = new FormData($('#audisee-upload-form')[0]);\n            if (!data) {\n                return;\n            }\n            $.ajax({\n                url: AuditController.BaseUrl + 'create', // point to server-side PHP script\n                dataType: 'json',\n                cache: false,\n                processData: false, // lets data be a FormData object\n                contentType: false, // lets data be a FormData object\n                data: data,\n                type: 'post',\n                xhr: AuditController.xhrProgress,\n                fail: function () {\n\n                },\n                success: function (result) {\n                    AuditController.csvUploadCallback(result);\n                }\n            });\n        }, 1500);\n    },\n    xhrProgress: function () {\n        //Upload progress\n        var xhr = new window.XMLHttpRequest();\n        xhr.upload.addEventListener(\"progress\", function (evt) {\n            if (evt.lengthComputable) {\n                var percent = evt.loaded / evt.total;\n                Report.uploadProgress = percent;\n            }\n        }, false);\n        return xhr;\n    },\n    csvUploadCallback: function (result) {\n        if (result.error != false) {\n            trackGaEvent('Audisee|4-Bad File');\n            AuditController.Error = result.error;\n            AuditController.showError();\n        } else {\n            Report.progressTitle = 'Upload Complete, Prepping File.';\n            $('.progress-circ i').removeClass('fa-circle-o-notch').addClass('fa-gear');\n            $('.progress-circ span').text('');\n            trackGaEvent('Audisee|4-Good File');\n            AuditController.AuditID = result.id;\n            Report.total_records = result.records;\n            Report.carrier = result.carrier;\n            Report.title = 'Auditing ' + Report.$options.filters.number(Report.total_records) + ' Records';\n            AuditController.run();\n        }\n    },\n    run: function () {\n        trackGaEvent('Audisee|5-Audit.run Initiated');\n        $.ajax({\n            url: AuditController.BaseUrl + AuditController.AuditID + '/run' + AuditController.nocache()\n        }).fail(function () {\n            trackGaEvent('Audisee|5-Audit.run 500 error');\n            AuditController.retryRun();\n        }).done(function (data) {\n            trackGaEvent('Audisee|5-Audit.run Success');\n            data = JSON.parse(data);\n            if (data.status == 'complete') {\n                if (Report.isFedEx) {\n                    AuditController.fetchAuditResults(false);\n                } else if(Report.isUPS) {\n                    Report.progressTitle = 'UPS File Processing.<br/> We Will Check On Progress In:';\n                    Report.timerCallback = AuditController.fetchUpsProgress; // setTimeout this on timer completion\n                    Report.startTimer(AuditController.upsProgressDelayInSeconds);\n                }\n                Busy.hide();\n            } else if (data.status == 'not-complete') {\n                AuditController.retryRun();\n            }\n        });\n        //if (Report.isUPS) {\n        //    AuditController.showUpsProgress();\n        //}\n        _gaq.push(['_trackEvent', 'Interaction', 'DemoAudit', 'Audit Ran']);\n    },\n    retryRun: function () {\n        Busy.show();\n        setTimeout(function () {\n            AuditController.run();\n        }, 15000);//recursive\n    },\n    showError: function () {\n        $('.radial-progress').hide();\n        $('.upload-messages #unknown-file').show();\n        $('.step:visible > h2, .step:visible > div:nth-child(2)').hide();\n    },\n    load: function (id) {\n        if (id == '') {\n            Interview.nextStep();\n            Interview.nextTitle();\n        } else {\n            AuditController.Rerun = true;\n            AuditController.AuditID = id;\n            AuditController.FetchResultsDelay = -1;\n            Interview.nextTitle();\n            AuditController.fetchAuditResults();\n        }\n    },\n    animateUpload: function () {\n        if (this.AuditID.length > 0 && Report.total_findings > 0) {\n            Interview.nextStep();\n            AuditController.showRevisit();\n            AuditController.runAnimation();\n        }\n    },\n    showRevisit: function () {\n        var field = $('#revisit-link');\n        var url = field.attr('data-base') + this.AuditID;\n        field.val(url);\n        $('#audit-share').removeClass('pending hidden');\n    },\n    fetchUpsProgress: function () {\n        Report.progressTitle = 'Checking On Progress.';\n        var url = AuditController.BaseUrl + AuditController.AuditID + '/status' +  AuditController.nocache();\n        $.ajax({\n            url: url\n        }).fail(function () {\n            setTimeout(function(){ AuditController.fetchUpsProgress(); }, 5000);\n        }).done(function (data) {\n            data = JSON.parse(data);\n            if (data.status == 'processing') {\n                Report.startTimer(guessRuntime(AuditController.upsProgressDelayInSeconds, data.progress['current-records'], data.progress['total-records']));\n                Report.progressTitle = 'Expecting Audit Results In: ';\n            } else if (data.status == 'complete') {\n                AuditController.fetchAuditResults(false);\n                Report.timerCallback = [];\n            }\n        });\n    },\n    fetchAuditResults: function () {\n        Report.timerMsg('');// removes timer message\n        Report.progressTitle = 'Audit Complete, Fetching Results.';\n        if (!Report.findings.length) {\n            $.get(AuditController.BaseUrl + AuditController.AuditID + '/results' + AuditController.nocache(),\n                function (data) {\n                    Interview.nextTitle();\n                    Report.findings = JSON.parse(data);\n                    setTimeout(animateNumbers, 500);\n                    Report.uploadProgress = .999;\n                    AuditController.animateUpload();\n                    AuditController.getStats();\n                    if (AuditController.Rerun) {\n                        Report.title = 'Loading Audit Results';\n                        AuditController.AnimationRuntime = 7000;\n                        trackGaEvent('Audisee|Rerun');\n                    } else{\n                        Report.title = 'Audit In Progress';\n                    }\n                    Interview.showStep(3);\n                    AuditController.showRevisit();\n                    AuditController.runAnimation();\n                    Vue.nextTick(function(){\n                        Report.$data.selected_point = $('#point-select option:first-child').attr('value');\n                    });\n                });\n        }\n    },\n    runAnimation: function () {\n        animateProgressMeter();\n        setTimeout(function () {\n            AuditController.complete()\n        }, AuditController.AnimationRuntime + 1200);\n    },\n    complete: function () {\n        Charts.drawCharges();\n        //remove progress meter\n        setTimeout(function () {\n            //change title\n            $('.progress-meter').hide();\n            if (AuditController.Rerun) {\n                Report.title = 'Audited ' + Report.$options.filters.number(Report.total_shipments) + ' Shipments';\n            } else {\n                Report.title = 'Finished Auditing ' + Report.$options.filters.number(Report.total_shipments) + ' Shipments';\n            }\n            $('.convert').show();\n        }, 1000);\n        //show navigation buttons\n        $('.tab-controls .btn').addClass('brightBlue');\n        if (Report.findings.length > 0) {\n            $('.tab-controls .btn:gt(0)').addClass('animated slideInTop flatGrey');\n            $('.tab-controls .btn').removeClass('hidden');\n        }\n        $('.tab-controls .btn:last-child').removeClass('hidden');//always show stats\n        $('.total-recovery, .total').each(function () {\n            var t = parseFloat($(this).text().replace(',', '')).forHumans(2);\n            $(this).text(t);\n        });\n        if (Report.total_recovery < AuditController.uncompellingMessageMaxSavings) {\n            $('.uncompelling-modal').modal('show');\n        }\n    },\n    refreshStats: function(delay){\n        setTimeout(function(){ AuditController.getStats(); }, delay);\n    },\n    getStats: function () {\n        $.ajax({\n            url: AuditController.BaseUrl + AuditController.AuditID + '/stats' + AuditController.nocache()\n        }).fail(function(){\n            AuditController.refreshStats(5000);\n        }).done(function (data) {\n            Report.carrier          = data.carrier;\n            Report.total_records    = data.total_records;\n            Report.total_shipments  = data.total_shipments;\n            Report.shipment_range   = data.shipment_range;\n            Report.invoice_range    = data.invoice_range;\n            Report.invoice_details  = data.invoice_details;\n            if(data.total_records > 0 && data.invoice_details == false){\n                AuditController.refreshStats(5000);\n            }\n        });\n    }\n}; // end Audit\n\nfunction guessRuntime(delay, current, total){\n    var runtimeGuess = (delay / current) * (total - current);\n    if (runtimeGuess < 5) {\n        runtimeGuess = 5;\n    } else if (runtimeGuess > 300) { //5 minutes\n        runtimeGuess = 300;\n    }\n    return runtimeGuess;\n}\n\n$(document).ready(function () {\n    // select csv\n    $(document).on('click', '.upload-btn', function () {\n        var valid = validateVisible();\n        if (!valid) {\n            return false;\n        }\n        $('#invoice-csv').click();\n    });\n    // drop validation error\n    $(document).on('blur', '.required', function () {\n        if ($(this).val() != '') {\n            $(this).tooltip('hide');\n        }\n    });\n    // bind tool tips\n    $(function () {\n        $('[data-toggle=\"tooltip\"]').tooltip({\n            trigger: 'manual'\n        })\n    });\n    // bind uploadcsv\n    $(document).on('change', '#invoice-csv', function () {\n        var file = $(this).val();\n        if (file == '') {\n            $('#upload-btn').show();\n            $('#submit-btn').hide();\n        } else if (file.substring(file.length - 4) != '.csv' && file.substring(file.length - 4) != '.xml') {\n            $(this).val('');\n            alert('Please select a .csv or .xml file instead');\n        } else if (calcFileSize(this) > 110000000) {\n            $('#email-reminder').val($('#upload-csv input[name=hs\\\\[email\\\\]]').val());\n            $('#filesize-modal').modal('show');\n            var btn = $('#request-large-audit');\n            var msg = btn.attr('data-message');\n            btn.attr('data-message', msg + $('#upload-csv').serialize())\n        } else {\n            AuditController.uploadCSV();\n        }\n    });\n    Interview.init(false);\n    $('.progress-indicator').css({'opacity': 1, 'background-color': '#45bbf6'});\n    $('.info').tooltip();\n});\n$(document).on('click', '.show-revisit', function () {\n    AuditController.showRevisit();\n});\n\nCharts = {\n    data: {},\n    addData: function (charge, point) {\n        if (typeof(this.data[point]) == 'undefined') {\n            this.data[point] = {charges: 0, count: 0, 'label': /*AuditCard.pointsForHumans[point].name*/ ''};\n        }\n        this.data[point].charges = this.data[point].charges + toFloat(charge);\n        this.data[point].count++;\n    },\n    output: function (field, title) {\n        var output = [['Audit Point', title]];\n        output.push(this.data);\n        return output;\n    },\n    drawCharges: function () {\n        var data = [['Audit Point', 'Total Charges']];\n        for(var i in Report.points){\n            var name = Report.points[i].name;\n            var total = Report.pointTotal(i);\n            data.push([ name ,  total ]);\n        }\n        this.pieChart('charges-chart', 'Potential Recovery Overview', data);\n    },\n    pieChart: function (targetId, title, data) {\n        data = google.visualization.arrayToDataTable(data);\n        var options = {\n            title: title,\n            pieHole: 0.4,\n            backgroundColor: 'transparent',\n            colors: ['#00C853', '#164260', '#7e888c', '#00ACED', '#e18c4b', '#7c529f']\n        };\n        var formatter = new google.visualization.NumberFormat({\n            decimalSymbol: '.',\n            groupingSymbol: ',',\n            prefix: '$'\n        });\n        formatter.format(data, 1);\n        var chart = new google.visualization.PieChart(document.getElementById(targetId));\n        chart.draw(data, options);\n    }\n};\n\n// Helper Functions\nfunction animateNumbers(){\n    $('*[data-animate-to]').each(function(){\n        var decimals = $(this).hasClass('currency');\n        var target =  $(this);\n        var total  = parseFloat($(this).attr('data-animate-to'));\n        $({numberValue: 0}).animate({numberValue: total}, {\n            duration:  AuditController.AnimationRuntime,\n            easing: 'linear',\n            step: function() {\n                if(decimals){\n                    $(target).text((Math.ceil(this.numberValue*100)/100).toFixed(2));\n                }else{\n                    $(target).text(Math.ceil(this.numberValue));\n                }\n            },\n            complete: function(){\n                target.text(parseFloat(target.attr('data-animate-to')).forHumans((decimals ? 2 : 0)));\n            }\n        });\n    });\n}\n\nfunction calcFileSize(input) {\n    var files = $(input)[0].files;\n    var totalSize = 0;\n    $(files).each(function () {\n        totalSize = totalSize + this.size;\n    });\n    return totalSize;\n}\n\n$(document).on('click', '#confirm-email', function () {\n    slack('Big Audit Email: ' + $('#email-reminder').val(), false);\n    $('#confirm-email').html('&check;');\n});\n$(document).on('keyup', '#email-reminder', function () {\n    $('#confirm-email').html('UPDATE');\n});\n$(document).on('click', '.close-modal', function () {\n    $('.modal .close').trigger('click');\n});\n$(document).on('click', '#request-large-audit', function () {\n    $('#request-large-audit-before').hide();\n    $('#request-large-audit-after').show();\n});\n$(document).on('click', '.no-invoices', function () {\n    alert(\"While you may be able to log in, some sets of credentials are \" +\n        \"limited in what they can view. Consider using administrator or \" +\n        \"accounts-payable login info. If you’re still stuck, call UPS/FedEx \" +\n        \"support and see if they can help you troubleshoot your account.\");\n});\n$(document).on('click', '.convert', function () {\n    $('.convert-modal').modal('show');\n    _gaq.push(['_trackEvent', 'Interaction', 'DemoAudit', 'Audit Recover Button Pressed']);\n});\n$(document).on('click', '.convert', function () {\n    $('.convert-modal').modal('show');\n    _gaq.push(['_trackEvent', 'Interaction', 'DemoAudit', 'Audit Recover Button Pressed']);\n});\n\ngoogle.load(\"visualization\", \"1\", {packages: [\"corechart\"]});\nfunction toFloat(num) {\n    if (num == '' || num == null || typeof(num) == 'undefined' || isNaN(num)) {\n        return 0;\n    } else {\n        return parseFloat(num);\n    }\n}\n$(document).on('click', '.tab-controls .btn', function () { //simple tabs\n    var btn = $(this);\n    var i = btn.index();\n    $('.tabs .tab:not(' + i + ')').hide();\n    $('.tabs .tab:eq(' + i + ')').show();\n    $('.tab-controls .btn').removeClass('brightBlue').addClass('flatGrey');\n    btn.addClass('brightBlue').removeClass('flatGrey');\n});\n$(document).on('click', '.show-ups-instructions', function () {\n    $('.ups-instructions').show();\n    $('.fedex-instructions').hide();\n});\n$(document).on('click', '.show-fedex-instructions', function () {\n    $('.fedex-instructions').show();\n    $('.ups-instructions').hide();\n});\n$(document).on('click', '#audit-share .close', function () {\n    $('#audit-share').addClass('after');\n});\n$(document).on('click', '#audit-share.after', function () {\n    $('#audit-share').removeClass('after');\n});\n$(document).on('click', '.draw-charges', function () {\n    setTimeout(function () {\n        Charts.drawCharges();\n    }, 5); //refreshes svg size\n});\nfunction increment(target) {\n    target.text(parseInt(target.text()) + 1);\n}\nNumber.prototype.forHumans = function (precision) {\n    return this.toFixed(precision).toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n};\nNumber.prototype.msAsSeconds = function () {\n    return Math.ceil(this / 1000);\n};\nfunction getRandomInt(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction animateProgressMeter() {\n    $('.interview-title .progress-indicator').css({\n        transition: 'width ' + (AuditController.AnimationRuntime / 1000) + 's'\n    });\n    setTimeout(function () {\n        $('.progress-indicator').css('width', '100%');\n    }, 1000);\n}\n\n\n//animate numbers\n(function (d) {\n    var p = function (b) {\n        return b.split(\"\").reverse().join(\"\")\n    }, l = {\n        numberStep: function (b, a) {\n            var e = Math.floor(b);\n            d(a.elem).text(e)\n        }\n    }, h = function (b) {\n        var a = b.elem;\n        a.nodeType && a.parentNode && (a = a._animateNumberSetter, a || (a = l.numberStep), a(b.now, b))\n    };\n    d.Tween && d.Tween.propHooks ? d.Tween.propHooks.number = {set: h} : d.fx.step.number = h;\n    d.animateNumber = {\n        numberStepFactories: {\n            append: function (b) {\n                return function (a, e) {\n                    var k = Math.floor(a);\n                    d(e.elem).prop(\"number\", a).text(k + b)\n                }\n            }, separator: function (b, a) {\n                b = b || \" \";\n                a =\n                    a || 3;\n                return function (e, k) {\n                    var c = Math.floor(e).toString(), s = d(k.elem);\n                    if (c.length > a) {\n                        for (var f = c, g = a, l = f.split(\"\").reverse(), c = [], m, q, n, r = 0, h = Math.ceil(f.length / g); r < h; r++) {\n                            m = \"\";\n                            for (n = 0; n < g; n++) {\n                                q = r * g + n;\n                                if (q === f.length)break;\n                                m += l[q]\n                            }\n                            c.push(m)\n                        }\n                        f = c.length - 1;\n                        g = p(c[f]);\n                        c[f] = p(parseInt(g, 10).toString());\n                        c = c.join(b);\n                        c = p(c)\n                    }\n                    s.prop(\"number\", e).text(c)\n                }\n            }\n        }\n    };\n    d.fn.animateNumber = function () {\n        for (var b = arguments[0], a = d.extend({}, l, b), e = d(this), k = [a], c = 1, h = arguments.length; c < h; c++)k.push(arguments[c]);\n        if (b.numberStep) {\n            var f =\n                this.each(function () {\n                    this._animateNumberSetter = b.numberStep\n                }), g = a.complete;\n            a.complete = function () {\n                f.each(function () {\n                    delete this._animateNumberSetter\n                });\n                g && g.apply(this, arguments)\n            }\n        }\n        return e.animate.apply(e, k);\n    }\n})(jQuery);\n\n$(document).on('click', '.inst-btn', function () {\n    $('#empty-modal .modal-footer').html('');\n    var target = $($(this).data('target'));\n    var title  = $(this).data('title');\n    var inst   = $('.instructions:visible');\n    var backBtn = $('#sm-back-btn-proto').html();\n    var closeBtn = $('#sm-close-btn-proto').html();\n    if ($(this).data('btn') == false) {\n        backBtn = '';\n    }\n    //inst.addClass('animated flipOutX');\n    inst.css('display', 'none');\n    $(target).css('display', 'block');\n    //$(target).css('display', 'block').addClass('animated flipInX').removeClass('flipOutX');\n    $('#empty-modal .modal-title').html(title);\n    $('#empty-modal .modal-footer').html(backBtn + closeBtn);\n});\n\n// \"busy\" modal counter\nBusy = {\n    interval: false,\n    show: function () {\n        $('#busy').modal('show');\n        Busy.updateTimer(15);\n        Busy.startTimer();\n    },\n    hide: function () {\n        $('#busy').modal('hide');\n        window.clearInterval(Busy.interval);\n    },\n    startTimer: function () {\n        if (!Busy.interval) {\n            Busy.interval = setInterval(Busy.decrimentTimer, 1000);\n        }\n    },\n    decrimentTimer: function () {\n        var next = Busy.getTime() - 1;\n        Busy.updateTimer(next);\n    },\n    updateTimer: function (time) {\n        if (time > 0) {\n            $('#busy-timer').text(time);\n        }\n    },\n    getTime: function () {\n        return parseInt($('#busy-timer').text());\n    }\n};\n"],"sourceRoot":"/source/"}